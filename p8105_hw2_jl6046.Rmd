---
title: "P8105 HW2 jl6046"
author: "Brian Jo Hsuan Lee"
date: 2021-10-07
output: github_document
---

Import packages

```{r, message = FALSE}
library(tidyverse)
library(readxl)
library(tidyr)
library(dplyr)
```

## Problem 1:

Set Mr. Trash Wheel excel file path

```{r}
trashwheel_path = "./hw2_files/Trash-Wheel-Collection-Totals-7-2020-2.xlsx"
```

Import and clean sheet "Mr. Trash Wheel" from the excel spreadsheet.

```{r, message = FALSE}
tw_df = 
  read_excel(trashwheel_path, sheet = 1) %>%
  janitor::clean_names() %>%
  drop_na(dumpster) %>%
  mutate(
    sports_balls = round(sports_balls))
```

Import, clean and combine sheets "2019 Precipitation" and "2019 Precipitation."

```{r}
prcp_2018_df = 
  read_excel(trashwheel_path, sheet = "2018 Precipitation", range = "A2:B14") %>%
  janitor::clean_names() %>%
  mutate(
    year = 2018
  )

prcp_2019_df = 
  read_excel(trashwheel_path, range = "2019 Precipitation!A2:B14") %>%
  janitor::clean_names() %>%
  drop_na(total) %>%
  mutate(
    year = 2019
  )

prcp_df =
  bind_rows(prcp_2018_df, prcp_2019_df) %>%
  mutate(
    month = month.name[month]
  )
```

There are 17 variables and 454 observations in the Mr. Trash Wheel data frame, including information on dumpster IDs, date, and the types and weight of collected trash. On the other hand, the combined precipitation data formed a 3 variable 24 observation data frame, where the date and monthly precipitation were recorded. 

The cells of annual precipitation were omitted when we read in the spread sheets, but we may calculate it with the data we have. The total precipitation in 2018 is 70.33.

```{r}
aggregate(total ~ year, prcp_df, sum)
```

Using the same method, we can acquire the median number of sports balls from a dumpster is 9 in 2019. 

```{r}
aggregate(sports_balls ~ year, tw_df, median)
```


## Problem 2

Set FiveThirtyEight csv file paths

```{r}
pols_month_538_path = "./hw2_files/pols-month.csv"
unemployment_538_path = "./hw2_files/unemployment.csv"
snp_538_path = "./hw2_files/snp.csv"
```

```{r, message = FALSE}
pols_df = 
  read_csv(pols_month_538_path) %>% 
  separate(col = mon, into = c('year', 'month', 'day'), sep = '-') %>% 
  mutate(
    month = month.name[as.numeric(month)],
    month = as.factor(month),
    month = ordered(month, levels = month.name)
  ) %>%
  pivot_longer(
    c(prez_gop, prez_dem),
    names_to = "president",
    names_prefix = "prez_",
    values_to = "president_TF"
  ) %>% 
  subset(president_TF == 1) %>% 
  select(- c(president_TF, day)) %>% 
  arrange(year, month)
```

```{r, message = FALSE}
snp_df = 
  read_csv(snp_538_path) %>% 
  separate(col = date, into = c("month", "day", "year"), sep = "/") %>% 
  mutate(
    year = case_when(as.numeric(year) <= 15 ~ as.numeric(year) + 2000,
                     TRUE ~ as.numeric(year) + 1900), 
    year = as.character(year),
    month = month.name[as.numeric(month)],
    month = as.factor(month),
    month = ordered(month, levels = month.name)
  ) %>% 
  select(year, month, everything()) %>% 
  arrange(year, month)
```

```{r}
unemp_df = 
  read_csv(unemployment_538_path) %>%
  janitor::clean_names() %>% 
  pivot_longer(
    c(-year),
    names_to = "month",
    values_to = "unemp_rate"
  ) %>% 
  filter(!is.na(unemp_rate)) %>% 
  mutate(
    year = as.character(year),
    month = stringr::str_to_title(month),
    month = replace(month, month == month.abb[1], month.name[1]), 
    month = replace(month, month == month.abb[2], month.name[2]), 
    month = replace(month, month == month.abb[3], month.name[3]),
    month = replace(month, month == month.abb[4], month.name[4]), 
    month = replace(month, month == month.abb[5], month.name[5]), 
    month = replace(month, month == month.abb[6], month.name[6]),
    month = replace(month, month == month.abb[7], month.name[7]), 
    month = replace(month, month == month.abb[8], month.name[8]), 
    month = replace(month, month == month.abb[9], month.name[9]),
    month = replace(month, month == month.abb[10], month.name[10]), 
    month = replace(month, month == month.abb[11], month.name[11]), 
    month = replace(month, month == month.abb[12], month.name[12]),
    month = as.factor(month),
    month = ordered(month, levels = month.name)
  ) %>% 
  arrange(year, month)
```

```{r}
fivethirtyeight_df =
  full_join(pols_df, snp_df, by = c("year", "month")) %>%
  full_join(., unemp_df, by = c("year", "month")) %>% 
  arrange(year, month)
```

## Problem 3

```{r}
baby_name_path = "./hw2_files/Popular_Baby_Names.csv"
```

```{r}
bn_df = 
  read_csv(baby_name_path) %>% 
  janitor::clean_names() %>% 
  select(gender, ethnicity, year_of_birth, count, rank, childs_first_name) %>% 
  pivot_wider(
    names_from = year_of_birth,
    values_from = rank
  )
```

